include <helper.scad>
use <../Lamp Base/Lamp Base.scad>

lid_r = norm([143.069 - 78.521 + 2 + 10, 10 + 2 + 10])/2 + 1;

module lip(w, d, r1, r2){
	at(r1, r1) diff()
	{
		hull(){
			at(w - 2*r1, d - 2*r1) cyl(r1 + r2, r1 + r2);
			at(0, d - 2*r1) rotate(90*Z) cyl(r1 + r2, r1 + r2);
			rotate(180*Z) cyl(r1 + r2, r1 + r2);
			at(w - 2*r1) rotate(270*Z) cyl(r1 + r2, r1 + r2);
		}
		up(r2) {
			at(w - 2*r1, d - 2*r1) rotate_extrude(90) at(r1 + r2) circle(r2);
			at(0, d - 2*r1) rotate(90*Z) rotate_extrude(90) at(r1 + r2) circle(r2);
			rotate(180*Z) rotate_extrude(90) at(r1 + r2) circle(r2);
			at(w - 2*r1) rotate(270*Z) rotate_extrude(90) at(r1 + r2) circle(r2);
			
			at(-r2 - r1) cyl(d - 2*r1, r2, dir_y = 1);
			at(w + r2 - r1) cyl(d - 2*r1, r2, dir_y = 1);
			at(0, -r2 - r1)cyl(w - 2*r1, r2, dir_x = 1);
			at(0, d + r2 - r1) cyl(w - 2*r1, r2, dir_x = 1);
		}
	}
}

module cone2D(lid_r){
	shape1 = [[0, 311],[110, 311],[lid_r, 0],[0,0]];
	polygon(shape1);
}

module handle2D(height){
	shape1 = [[78.521,342.281],[143.069,342.224],[142.06,419.267],[141.819,420.231],[141.658,421.196],[141.417,421.919],[140.935,423.446],[140.694,424.491],[140.292,425.535],[139.569,427.143],[139.247,428.027],[138.604,428.911],[138.122,429.634],[137.238,430.679],[136.434,431.804],[135.39,432.768],[134.265,433.974],[132.577,435.179],[131.291,436.063],[129.523,437.269],[128.237,438.073],[127.032,438.796],[125.082,439.94],[97.837,456.013],[96.632,456.897],[95.587,457.781],[94.623,458.585],[93.658,459.871],[92.694,460.996],[92.051,462.362],[91.247,463.889],[90.765,465.657],[90.444,467.265],[90.151,469.015],[89.669,515.307],[89.829,517.235],[90.151,519.084],[90.713,521.816],[91.356,523.745],[92.24,526.156],[93.526,528.326],[94.892,530.174],[97.062,532.344],[99.473,534.032],[101.724,535.157],[103.331,535.639],[105.179,536.041],[107.269,536.122],[109.117,536.122],[111.448,535.72],[113.859,535.157],[116.35,534.032],[118.601,532.907],[120.771,531.38],[122.378,529.612],[124.307,527.442],[125.673,525.433],[126.718,523.263],[127.762,521.013],[128.084,519.084],[128.325,517.396],[128.486,515.708],[128.646,513.699],[129.048,512.092],[129.691,510.806],[130.575,509.681],[131.7,508.958],[132.826,508.315],[134.192,507.913],[136.04,507.993],[137.165,508.475],[138.371,509.359],[139.255,510.645],[139.978,511.77],[140.621,513.297],[140.862,515.065],[140.862,516.592],[140.862,518.2],[140.702,520.048],[140.38,521.736],[139.817,523.825],[139.255,525.835],[138.612,527.726],[137.828,529.685],[136.849,531.938],[135.576,534.092],[134.106,536.541],[132.147,538.892],[130.188,540.949],[127.74,543.202],[125.389,545.161],[122.744,546.63],[119.022,548.197],[115.594,548.981],[111.774,549.764],[108.346,550.156],[104.623,549.96],[101.587,549.373],[98.355,548.491],[94.829,547.022],[91.498,545.063],[88.952,543.006],[86.503,540.753],[84.348,538.206],[82.781,535.954],[81.311,533.113],[80.234,530.86],[79.059,527.628],[78.275,524.787],[77.687,521.555],[77.198,518.421],[77.002,516.07],[76.806,513.621],[77.1,481.885],[76.904,480.416],[76.512,479.437],[75.826,477.967],[74.945,476.988],[73.573,476.302],[71.908,475.812],[69.949,475.812],[68.088,476.302],[66.717,477.086],[31.945,496.774],[30.28,497.263],[28.615,497.165],[26.656,496.676],[25.088,495.598],[23.913,494.129],[22.738,492.366],[22.248,490.505],[22.248,488.84],[22.542,486.979],[23.423,485.118],[24.893,483.942],[26.851,482.669],[67.305,458.377],[69.166,457.006],[71.517,454.949],[73.769,452.207],[75.043,450.052],[76.218,447.211],[77.1,444.077],[77.296,441.236],[76.904,385.209],[76.414,382.369],[75.728,380.801],[75.141,379.528],[74.259,377.961],[72.79,376.296],[0.405,293.137],[-0.672,291.667],[-1.26,290.002],[-1.75,288.141],[-1.848,286.378],[-1.848,284.811],[-1.162,282.852],[0.111,281.481],[1.189,280.893],[3.05,280.207],[5.205,280.305],[7.066,280.893],[8.829,281.872],[10.788,283.244],[12.355,285.007],[64.17,345.05],[65.444,346.519],[66.815,347.792],[68.186,349.066],[69.655,350.045],[71.321,350.829],[72.986,351.221],[74.749,351.123],[76.316,350.339],[77.296,349.36],[77.785,348.282],[78.079,347.107],[78.275,345.148]];
	shape2 = [[99.334,352.2],[122.744,353.376],[124.507,353.963],[125.879,354.845],[127.152,356.118],[127.838,357.783],[128.327,359.742],[128.621,416.259],[128.229,417.435],[127.74,418.806],[127.152,420.177],[126.172,421.353],[125.193,422.234],[100.901,438.592],[99.53,439.179],[98.257,439.473],[96.592,439.473],[95.122,439.179],[93.751,438.2],[93.163,436.829],[92.38,435.065],[92.184,433.204],[91.988,431.539],[92.38,359.938],[92.87,357.979],[93.457,356.51],[94.437,354.845],[95.416,353.571],[96.983,352.69],[98.355,352.396]];
	diff(){
		linear_extrude(height) polygon(shape1);
		linear_extrude(height) polygon(shape2);
	}
}

module cone(){
	diff(){
		rotate_extrude($fn = 180) cone2D(lid_r);
		r = 65/2;
		ScrewThread(2*(r + 5) + 1.25, 10, tooth_angle = 45);
	}
}

module handle(){
	at(78.521 - 1, 342.281 - 1, 11) rotate(-90*X) lip(143.069 - 78.521 + 2, 10 + 2, 1, 5);
	

	at((143.069 - 78.521)/2 + 78.521, 342.281 - 1, 5) rotate(90*X) up(37.5) interface(65, false, 2){
		cyl(20, lid_r, 1);
	}
	minkowski(){	
		handle2D(10);
		sphere(1);
	}
}

module handle2(){
	interface(65, false, 2){
		union(){
			rotate(-90*X) at(-(143.069 - 78.521)/2 - 78.521, -342.281 + 1, -5){
				at(78.521 - 1, 342.281 - 1, 11) rotate(-90*X) lip(143.069 - 78.521 + 2, 10 + 2, 1, 5);
				minkowski(){	
					handle2D(10);
					sphere(1);
				}
			}
			cyl(20, lid_r, 1);
		}
	}
	
}

//keep(zMin = 10, zMax = 249) cone();
//keep(zMax = 10) cone();
rotate(45*Z) rotate(90*Y) handle2();

